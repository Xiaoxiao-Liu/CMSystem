@model IEnumerable<CMSystem.Models.Announcement>


<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.AnnouncementTitle)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.AnnouncementContent)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.AnnoucingTime)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.ExpiryTime)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Role)
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.AnnouncementTitle)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.AnnouncementContent)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.AnnoucingTime)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.ExpiryTime)
            </td>
            <td>
       
            </td>
            <td>
                @Html.ActionLink("Edit", "Edit", new { id = item.AnnouncementId }) |
                @Html.ActionLink("Details", "Details", new { id = item.AnnouncementId }) |
                @*<a href="/Announcement/Delete/@item.AnnouncementId" data-toggle="popover" data-content="abcdefg" data-placement="auto right">Delete</a>*@
                @*<a href="#" class="btn btn-sm btn-danger" title="Confirmation" data-toggle="popover" data-placement="auto right" data-trigger="focus" data-html="true" data-content='<a class="btn btn-sm btn-danger deleteQuestion" rowno="@counter" value="@question.ID">Yes</a><a class="btn btn-sm btn-success popoverClose pull-right" >No</a>'>Delete</a>*@
                <a href="#" data-toggle="popover" title="Are you sure?" data-trigger="focus" data-content="<button class='btn btn-sm btn-info deleteButton' myid='@item.AnnouncementId'>Yes</button><button class='btn btn-sm btn-info CloseButton pull-right'>No</button>" data-html="true" data-placement="auto right">Delete</a>

                <!-- Button trigger modal -->
                <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#myModal">
                   Comment
                </button>

                <!-- Modal -->
                <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title" id="myModalLabel">Comment Here</h4>
                            </div>
                            <div class="modal-body">
                                Insert Partial View Here                            

                                <script>
                                    function CommentModels() {
                                        var comment = this;
                                        comment.AnnouncementId=@Html.Raw(Json.Encode(item.AnnouncementId));
                                        comment.CommentContent=$('#commentContent').val();
                                        comment.Anonymous=$('#anonymous').val();                                                                              
                                    }

                                    $('.newComment').click(function(){
                                        var CommentModels=new CommentModels();
                                        $.ajax({
                                            type:"POST",
                                            url:"@Url.Action("AJAXCreate", "Comment")",
                                            data:{CommentModels, __RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val() },
                                            success: function(res){
                                              
                                            }
                                        });
                                    });



                                </script>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                <button type="button" id="newComment" class="btn btn-primary">Save changes</button>
                            </div>
                        </div>
                    </div>
                </div>

            </td>
        </tr>
    }

</table>

<script>
        $(function () {
            $('[data-toggle="popover"]').popover();
            $('[data-toggle="popover"]').click(function (event) {
                event.preventDefault();
                $(".deleteButton").click(function () { 
                    var data = { id: $(this).attr('myid'), __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val() };
                    var button = $(this).parent().parent().parent().parent();
                    $.ajax({
                        type:"POST",
                        url: '/Announcement/AJAXDeleteConfirmed',
                        data:data,
                        success: function (result) {
                            console.log("success");
                            button.remove();
                        }
                    });
                    //$(this).attr('myid') get announcement ID
                });
                $(".CloseButton").click(function () {
                    $(this).popover('hide');
                })
            });
            //$('html').click(function (e) {
            //    $('[data-toggle="popover"]').popover('hide');
            //});
        });       
</script>



